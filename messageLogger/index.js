(function(c,l,s,d,r,u,g,p){"use strict";const{FormIcon:f,FormSwitchRow:h}=u.Forms;r.storage.nopk??=!1;function v(){return p.useProxy(r.storage),React.createElement(s.ReactNative.ScrollView,null,React.createElement(h,{label:"Ignore PluralKit",leading:React.createElement(f,{source:g.getAssetIDByName("ic_block")}),onValueChange:function(n){return void(r.storage.nopk=n)},value:r.storage.nopk}))}const o=[],i=l.findByProps("_channelMessages"),_=l.findByProps("updateMessageRecord","createMessageRecord"),m=l.findByName("MessageRecord",!1),E=l.findByName("RowManager");o.push(d.before("dispatch",s.FluxDispatcher,function(n){let[e]=n;if(e.type==="MESSAGE_DELETE"){if(e.__vml_cleanup)return e;const t=i.get(e.channelId)?.get(e.id);return!t||t.author?.id=="1"||t.state=="SEND_FAILED"?e:(r.storage.nopk&&fetch(`https://api.pluralkit.me/v2/messages/${encodeURIComponent(t.id)}`).then(function(a){return a.json()}).then(function(a){t.id===a.original&&!a.member?.keep_proxy&&s.FluxDispatcher.dispatch({type:"MESSAGE_DELETE",id:t.id,channelId:t.channel_id,__vml_cleanup:!0})}),[{message:{...t.toJS(),__vml_deleted:!0},type:"MESSAGE_UPDATE"}])}})),o.push(d.after("generate",E.prototype,function(n,e){let[t]=n;t.rowType===1&&t.message.__vml_deleted&&(e.message.edited="deleted",e.backgroundHighlight??={},e.backgroundHighlight.backgroundColor=s.ReactNative.processColor("#da373c22"),e.backgroundHighlight.gutterColor=s.ReactNative.processColor("#da373cff"))})),o.push(d.instead("updateMessageRecord",_,function(n,e){let[t,a]=n;return a.__vml_deleted?_.createMessageRecord(a,t.reactions):e.apply(this,[t,a])})),o.push(d.after("createMessageRecord",_,function(n,e){let[t]=n;e.__vml_deleted=t.__vml_deleted,e.__vml_edits=t.__vml_edits})),o.push(d.after("default",m,function(n,e){let[t]=n;e.__vml_deleted=!!t.__vml_deleted,e.__vml_edits=t.__vml_edits}));const y=function(){o.forEach(function(n){return n()});for(const n in i._channelMessages)for(const e of i._channelMessages[n]._array)e.__vml_deleted&&s.FluxDispatcher.dispatch({type:"MESSAGE_DELETE",id:e.id,channelId:e.channel_id,__vml_cleanup:!0})};return c.onUnload=y,c.settings=v,c})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.components,vendetta.ui.assets,vendetta.storage);
