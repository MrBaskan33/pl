(function(B,g,s,c,d,h,u,S,x){"use strict";const{Permissions:T}=c.constants,{computePermissions:M}=s.findByProps("computePermissions","canEveryoneRole"),_=s.findByStoreName("GuildMemberStore"),C=[c.i18n.Messages.AI_TAG,c.i18n.Messages.BOT_TAG_SERVER,c.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,c.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,c.i18n.Messages.REMIXING_TAG],N=[{text:"Webhook",condition:function(t,e,n){return n.isNonUserBot()}},{text:"Owner",backgroundColor:"#ddb410",condition:function(t,e,n){return t?.ownerId===n.id}},{text:c.i18n.Messages.BOT_TAG_BOT,condition:function(t,e,n){return n.bot},verified:function(t,e,n){return n.isVerifiedBot()}},{text:"Admin",backgroundColor:"#c61212",permissions:["ADMINISTRATOR"]},{text:"Manager",backgroundColor:"#1883cb",permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"Moderator",backgroundColor:"#129b4b",permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function b(t,e,n){let a;if(t){const r=M({user:n,context:t,overwrites:e?.permissionOverwrites});a=Object.entries(T).map(function(o){let[i,l]=o;return r&l?i:""}).filter(Boolean)}for(const r of N)if(r.condition?.(t,e,n)||r.permissions?.some(function(o){return a?.includes(o)})){let o=g.storage.useRoleColor?_.getMember(t?.id,n.id)?.colorString:void 0,i=o||(r.backgroundColor??h.rawColors.BRAND_500),l=o||!r.textColor?c.chroma(i).get("lab.l")<70?h.rawColors.WHITE_500:h.rawColors.BLACK_500:r.textColor;return{...r,textColor:l,backgroundColor:i,verified:typeof r.verified=="function"?r.verified(t,e,n):r.verified??!1,condition:void 0,permissions:void 0}}}const A=s.findByName("getTagProperties",!1),G=s.findByStoreName("GuildStore"),I=s.findByStoreName("ChannelStore");function k(){return d.after("default",A,function(t,e){let[{message:n}]=t;if(!C.includes(e.tagText)){const a=I.getChannel(n.channel_id),r=G.getGuild(a?.guild_id),o=b(r,a,n.author);if(o)return{...e,tagText:o.text,tagTextColor:o.textColor?c.ReactNative.processColor(c.chroma(o.textColor).hex()):void 0,tagBackgroundColor:o.backgroundColor?c.ReactNative.processColor(c.chroma(o.backgroundColor).hex()):void 0,tagVerified:o.verified,tagType:void 0}}})}const E=s.findByProps("getBotLabel"),m=E.getBotLabel,w=s.findByStoreName("GuildStore"),L=function(t,e){let[{guildId:n,user:a}]=t;console.log(e);const r=u.findInReactTree(e.props.label,function(o){return o.type.Types});if(!r||!C.includes(m(r.props.type))){const o=w.getGuild(n),i=b(o,void 0,a);if(i)if(r)r.props={type:0,...i};else{const l=u.findInReactTree(e.props.label,function(y){return y.props?.lineClamp}).props.children;l.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(E.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}};function O(){const t=[];return s.findByTypeNameAll("UserRow").forEach(function(e){return t.push(d.after("type",e,L))}),function(){return t.forEach(function(e){return e()})}}const P=s.findByName("DisplayName",!1),D=s.findByName("HeaderName",!1),R=s.findByProps("getBotLabel"),U=R.getBotLabel,$=s.findByStoreName("GuildStore"),V=s.findByStoreName("ChannelStore");function F(){const t=[];return t.push(d.after("default",D,function(e,n){let[{channelId:a}]=e;n.props.channelId=a})),t.push(d.after("default",P,function(e,n){let[{guildId:a,channelId:r,user:o}]=e;const i=u.findInReactTree(n,function(l){return l.type.Types});if(!i||!C.includes(U(i.props.type))){const l=$.getGuild(a),y=V.getChannel(r),p=b(l,y,o);p&&(i?i.props={type:0,...p}:u.findInReactTree(n,function(ee){return ee.props.style.flexDirection==="row"}).props.children.push(React.createElement(R.default,{style:{marginLeft:0},type:0,text:p.text,textColor:p.textColor,backgroundColor:p.backgroundColor,verified:p.verified})))}})),function(){return t.forEach(function(e){return e()})}}const H=s.findByProps("GuildMemberRow"),v=s.findByProps("getBotLabel"),K=v.getBotLabel,W=s.findByStoreName("GuildStore");function j(){return d.after("type",H.GuildMemberRow,function(t,e){let[{guildId:n,channel:a,user:r}]=t;const o=u.findInReactTree(e,function(i){return i.type.Types});if(!o||!C.includes(K(o.props.type))){const i=W.getGuild(n),l=b(i,a,r);l&&(o?o.props={type:0,...l}:u.findInReactTree(e,function(y){return y.props.style.flexDirection==="row"}).props.children.splice(2,0,React.createElement(v.default,{type:0,text:l.text,textColor:l.textColor,backgroundColor:l.backgroundColor,verified:l.verified})))}})}const X=s.findByProps("getBotLabel");function Y(){return d.after("default",X,function(t,e){let[{text:n,textColor:a,backgroundColor:r}]=t;const o=u.findInReactTree(e,function(i){return typeof i.props.children=="string"});n&&(o.props.children=n),a&&o.props.style.push({color:a}),r&&e.props.style.push({backgroundColor:r})})}const{ScrollView:q}=x.General,{FormSection:z,FormSwitchRow:J}=x.Forms;function Q(){return S.useProxy(g.storage),React.createElement(q,{style:{flex:1}},React.createElement(z,{title:"Tag style"},React.createElement(J,{label:"Use top role color for tag backgrounds",value:g.storage.useRoleColor,onValueChange:function(t){g.storage.useRoleColor=t}})))}let f=[];var Z={onLoad:function(){g.storage.useRoleColor??=!1,f.push(k()),f.push(Y()),f.push(F()),f.push(j()),f.push(O())},onUnload:function(){return f.forEach(function(t){return t()})},settings:Q};return B.default=Z,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
