(function(y,r,d,m,b){"use strict";const{FormRow:p,FormTitle:v}=b.Forms,f=r.findByProps("getToken","setToken"),i=r.findByProps("getSettingsPanel")?.default,h=r.findByProps("getCurrentUser"),F=r.findByProps("getDeviceId"),l=12,o=16;function g(){return F?.getDeviceId?.()||"fallback-device-id"}async function w(n,t){const e=await crypto.subtle.importKey("raw",new TextEncoder().encode(n),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function A(n,t){const e=crypto.getRandomValues(new Uint8Array(o)),a=crypto.getRandomValues(new Uint8Array(l)),c=await w(t,e),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},c,new TextEncoder().encode(n)),u=new Uint8Array(o+l+s.byteLength);return u.set(e,0),u.set(a,o),u.set(new Uint8Array(s),o+l),btoa(String.fromCharCode(...u))}async function D(n,t){const e=Uint8Array.from(atob(n),function(R){return R.charCodeAt(0)}),a=e.slice(0,o),c=e.slice(o,o+l),s=e.slice(o+l),u=await w(t,a),C=await crypto.subtle.decrypt({name:"AES-GCM",iv:c},u,s);return new TextDecoder().decode(C)}async function E(){const n=f.getToken(),t=g(),e=h.getCurrentUser();if(!n||!e)return;const a=await A(n,t);d.storage.accounts=d.storage.accounts||[],d.storage.accounts.find(function(c){return c.id===e.id})||d.storage.accounts.push({id:e.id,name:e.username,token:a})}function P(){const n=g(),[t,e]=r.React.useState(d.storage.accounts??[]);return r.React.createElement(r.React.Fragment,null,r.React.createElement(v,{title:"Hesap De\u011Fi\u015Ftirici"}),t.length===0?r.React.createElement(p,{label:"Kay\u0131tl\u0131 hesap yok."}):t.map(function(a,c){return r.React.createElement(p,{key:c,label:a.name,subLabel:`ID: ${a.id}`,onPress:async function(){const s=await D(a.token,n);f.setToken(s),location.reload()}})}))}var k={onLoad:function(){if(E(),!i?.prototype?.render)return;const n=i.prototype.render;i.prototype.render=function(){const t=n.call(this);return t.props.children.push({type:"button",label:"Hesap De\u011Fi\u015Ftir",onPress:function(){return m.showModal("Hesap De\u011Fi\u015Ftir",P)}}),t}},onUnload:function(){i?.prototype?.render?._original&&(i.prototype.render=i.prototype.render._original)}};return y.default=k,Object.defineProperty(y,"__esModule",{value:!0}),y})({},vendetta.metro,vendetta.plugin,vendetta.ui.modal,vendetta.ui.components);
